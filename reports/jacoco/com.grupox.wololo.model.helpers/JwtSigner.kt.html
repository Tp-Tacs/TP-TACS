<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>JwtSigner.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wololo</a> &gt; <a href="index.source.html" class="el_package">com.grupox.wololo.model.helpers</a> &gt; <span class="el_source">JwtSigner.kt</span></div><h1>JwtSigner.kt</h1><pre class="source lang-java linenums">package com.grupox.wololo.model.helpers

import arrow.core.*
import com.grupox.wololo.errors.CustomException
import io.jsonwebtoken.*
import io.jsonwebtoken.security.Keys
import org.springframework.stereotype.Service
import java.security.KeyPair
import java.time.Duration
import java.time.Instant
import java.util.Date

@Service
<span class="fc" id="L14">object JwtSigner {</span>
<span class="fc" id="L15">    private val keyPair: KeyPair = Keys.keyPairFor(SignatureAlgorithm.RS256)</span>

    fun createJwt(userId: Int): String {
<span class="fc" id="L18">        return Jwts.builder()</span>
<span class="fc" id="L19">                .signWith(keyPair.private, SignatureAlgorithm.RS256)</span>
<span class="fc" id="L20">                .setSubject(userId.toString())</span>
<span class="fc" id="L21">                .setIssuer(&quot;identity&quot;)</span>
<span class="fc" id="L22">                .setExpiration(Date.from(Instant.now().plus(Duration.ofMinutes(1))))</span>
<span class="fc" id="L23">                .setIssuedAt(Date.from(Instant.now()))</span>
<span class="fc" id="L24">                .compact()</span>
    }

    fun validateJwt(jwt: Option&lt;String&gt;): Either&lt;CustomException, Jws&lt;Claims&gt;&gt; =
<span class="fc" id="L28">            try {</span>
<span class="fc" id="L29">                Right(Jwts.parserBuilder()</span>
<span class="fc" id="L30">                        .setSigningKey(keyPair.public)</span>
<span class="fc" id="L31">                        .build()</span>
<span class="fc" id="L32">                        .parseClaimsJws(jwt.getOrElse { throw CustomException.Unauthorized.TokenException(&quot;Token not found. Login Again&quot;) }))</span>
<span class="nc" id="L33">            } catch (ex: ExpiredJwtException) { Left(CustomException.Unauthorized.TokenException(&quot;Token expired. Login Again&quot;))</span>
<span class="fc" id="L34">            } catch (ex: CustomException) { Left(ex) }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>