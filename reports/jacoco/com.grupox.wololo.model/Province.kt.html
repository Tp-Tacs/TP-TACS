<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Province.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wololo</a> &gt; <a href="index.source.html" class="el_package">com.grupox.wololo.model</a> &gt; <span class="el_source">Province.kt</span></div><h1>Province.kt</h1><pre class="source lang-java linenums">package com.grupox.wololo.model

import arrow.core.*
import com.grupox.wololo.errors.CustomException
import com.grupox.wololo.model.helpers.AttackForm
import com.grupox.wololo.model.helpers.MovementForm

<span class="pc" id="L8">class Province(id: Int, val name: String, val towns: ArrayList&lt;Town&gt;){</span>
<span class="fc bfc" id="L9" title="All 6 branches covered.">    fun getTownById(id: Int): Either&lt;CustomException.NotFound, Town&gt; = towns.find { it.id == id }.rightIfNotNull { CustomException.NotFound.TownNotFoundException() }</span>

<span class="fc" id="L11">    fun maxAltitude(): Double = towns.map { it.elevation }.max()!!</span>

<span class="fc" id="L13">    fun minAltitude(): Double = towns.map { it.elevation }.min()!!</span>

<span class="nc" id="L15">    fun multDistance(): Double = TODO(&quot;logica multDist&quot;)</span>

<span class="nc" id="L17">    fun multAltitude(): Double = TODO(&quot;logica multAlt&quot;)</span>

<span class="pc bpc" id="L19" title="1 of 2 branches missed.">    fun townsFrom(user: User): List&lt;Town&gt; = towns.filter { it.isFrom(user) }</span>

<span class="pc bpc" id="L21" title="2 of 4 branches missed.">    fun allOccupiedTownsAreFrom(user: User): Boolean = towns.filter { it.owner != null }.stream().allMatch { it.owner == user }</span>

    fun addGauchosToAllTowns() {
<span class="fc" id="L24">        towns.forEach { it.addGauchos(maxAltitude(), minAltitude()) }</span>
<span class="fc" id="L25">    }</span>

    fun addGauchosToAllTownsFrom(user: User) {
<span class="nc" id="L28">        townsFrom(user).forEach { it.addGauchos(maxAltitude(), minAltitude()) }</span>
<span class="nc" id="L29">    }</span>

    fun unlockAllTownsFrom(user: User) {
<span class="fc" id="L32">        townsFrom(user).forEach { it.unlock() }</span>
<span class="fc" id="L33">    }</span>

    fun moveGauchosBetweenTowns(user: User, movementForm: MovementForm) {
<span class="pc" id="L36">        val fromTown = this.getTownById(movementForm.from).getOrHandle { throw it }</span>
<span class="pc" id="L37">        val toTown = this.getTownById(movementForm.to).getOrHandle { throw it }</span>
<span class="pc bpc" id="L38" title="2 of 4 branches missed.">        if(!fromTown.isFrom(user) || !toTown.isFrom(user))</span>
<span class="nc" id="L39">            throw CustomException.Forbidden.IllegalGauchoMovement(&quot;You only can move gauchos between your current towns&quot;)</span>
<span class="pc bpc" id="L40" title="1 of 2 branches missed.">        if(toTown.isLocked)</span>
<span class="nc" id="L41">            throw CustomException.Forbidden.IllegalGauchoMovement(&quot;You only can move gauchos to a town that is unlocked&quot;)</span>
<span class="fc" id="L42">        fromTown.giveGauchos(movementForm.gauchosQty)</span>
<span class="fc" id="L43">        toTown.receiveGauchos(movementForm.gauchosQty)</span>
<span class="fc" id="L44">    }</span>

    fun attackTown(user: User, attackForm: AttackForm) {
<span class="pc" id="L47">        val attacker = this.getTownById(attackForm.from).getOrHandle { throw it }</span>
<span class="pc" id="L48">        val defender = this.getTownById(attackForm.to).getOrHandle { throw it }</span>
<span class="pc bpc" id="L49" title="2 of 4 branches missed.">        if(!attacker.isFrom(user) || defender.isFrom(user))</span>
<span class="fc" id="L50">            throw CustomException.Forbidden.IllegalAttack(&quot;You only can attack from your town to an enemy town&quot;)</span>
<span class="nc" id="L51">        attacker.attack(defender, multDistance(), multAltitude())</span>
<span class="nc" id="L52">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>